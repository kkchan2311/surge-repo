#!name=Surge5 iOS 回国配置 v5.17.0
#!desc=适用于 Surge 5.17.0 iOS 的回国优先配置模板（含直连/回国/海外分流）

[General]
loglevel = notify
compatibility-mode = 3

# 连接与网络行为
block-quic = true
include-all-networks = true
exclude-simple-hostnames = true
exclude-suspended-proxies = true
wifi-assist = false
all-hybrid = true
udp-priority = false

# 连通性测试
internet-test-url = http://www.google.com/generate_204
proxy-test-url = http://cp.cloudflare.com/generate_204
test-timeout = 5
proxy-test-udp = www.apple.com@64.6.64.6

# IPv6（回国场景建议关闭，按需开启）
ipv6 = false
ipv6-vif = disabled

# DNS（国内解析优先 + 加密 DNS）
dns-server = system, 223.5.5.5, 119.29.29.29, 114.114.114.114
encrypted-dns-server = h3://dns.alidns.com/dns-query, h3://dns.google/dns-query
encrypted-dns-follow-outbound-mode = false
encrypted-dns-skip-cert-verification = false
hijack-dns = 8.8.8.8:53, 1.1.1.1:53, 223.5.5.5:53, 114.114.114.114:53

# 内网/本地地址绕行
skip-proxy = localhost, *.local, 0.0.0.0/8, 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.168.0.0/16

# GeoIP 与控制面板
geoip-maxmind-url = https://raw.githubusercontent.com/Hackl0us/GeoIP2-CN/release/Country.mmdb
disable-geoip-db-auto-update = true
http-api = your_api_password@0.0.0.0:6171
http-api-tls = true
http-api-web-dashboard = true

[Proxy]
# 请替换为你自己的回国节点（示例：WireGuard）
回国节点 = wireguard, section-name=CN_WG, test-url=http://1.0.0.1/generate_204, ecn=true

[Proxy Group]
# 回国策略组（可手动切换直连）
回国 = select, 回国节点, DIRECT

# 国内流量：优先直连，必要时可切回国节点
国内 = select, DIRECT, 回国节点

# 海外流量：默认走直连，可按需切回国节点
海外 = select, DIRECT, 回国节点

# 最终策略
兜底 = select, 国内, 回国, 海外, DIRECT

[Rule]
# 基础内网规则
RULE-SET,SYSTEM,DIRECT
RULE-SET,LAN,DIRECT

# 广告/隐私
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/reject.txt,REJECT
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/private.txt,DIRECT

# 抖音/字节系强制回国
OR,((DOMAIN-SUFFIX,amemv.com), (DOMAIN-SUFFIX,snssdk.com)),回国

# Apple 与 iCloud 直连
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/icloud.txt,DIRECT
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/apple.txt,DIRECT

# 国内规则（大陆域名 + 中国 IP）
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/direct.txt,国内
RULE-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/cncidr.txt,国内,no-resolve
GEOIP,CN,国内,no-resolve

# 海外规则
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/proxy.txt,海外
RULE-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/telegramcidr.txt,海外,no-resolve

# 兜底
FINAL,兜底,dns-failed

[Host]
# 路由器本地访问
router.asus.com = 192.168.1.1
tplinkwifi.net = 192.168.0.1
localhost = 127.0.0.1
*.local = 127.0.0.1

# 国内域名指定国内 DNS
*.cn = server:223.5.5.5
*.qq.com = server:119.29.29.29
*.tencent.com = server:119.29.29.29
*.taobao.com = server:223.5.5.5
*.tmall.com = server:223.5.5.5
*.baidu.com = server:180.76.76.76

# Apple 使用系统 DNS
*.apple.com = server:system
*.icloud.com = server:system

[MITM]
# 如不使用 MITM，可保留默认关闭状态
h2 = true
skip-server-cert-verify = false

[WireGuard CN_WG]
# 将以下内容替换为你的 WireGuard 回国节点参数
private-key = YOUR_PRIVATE_KEY
self-ip = 172.16.0.2
dns-server = 1.1.1.1
mtu = 1280
peer = (public-key = YOUR_SERVER_PUBLIC_KEY, allowed-ips = "0.0.0.0/0, ::0/0", endpoint = YOUR_SERVER_ENDPOINT:2408, keepalive = 25)
