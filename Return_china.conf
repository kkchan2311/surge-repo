[General]
loglevel = notify

# --- 1. 基础连接优化 ---
compatibility-mode = 3
block-quic = true
exclude-suspended-proxies = true
exclude-simple-hostnames = true
include-all-networks = true

# --- 2. 连接稳定性优化 ---
tcp-fast-open = true
udp-priority = false
all-hybrid = true
wifi-assist = false

# --- 3. 连通性测试 ---
internet-test-url = http://www.google.com/generate_204
proxy-test-url = http://cp.cloudflare.com/generate_204
test-timeout = 5
proxy-test-udp = www.apple.com@64.6.64.6

# --- 4. IPv6 处理 ---
ipv6 = false // 如无特殊需求不应开启 IPv6，目前网络环境下 IPv6 只会带来问题。
ipv6-vif = disabled

# --- 5. DNS 策略（回国 + 海外并存） ---
# 系统 DNS + 国内 DNS，优先保证回国解析质量
dns-server = system, 223.5.5.5, 119.29.29.29, 114.114.114.114
encrypted-dns-server = h3://dns.alidns.com/dns-query, h3://dns.google/dns-query
encrypted-dns-follow-outbound-mode = false
encrypted-dns-skip-cert-verification = false
hijack-dns = 8.8.8.8:53, 1.1.1.1:53, 223.5.5.5:53, 114.114.114.114:53

# --- 6. 本地流量绕行 ---
skip-proxy = localhost, *.local, 0.0.0.0/8, 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.168.0.0/16, *.edu.my, *.gov.my

# --- 7. GeoIP 与 Dashboard ---
geoip-maxmind-url = https://raw.githubusercontent.com/Hackl0us/GeoIP2-CN/release/Country.mmdb
disable-geoip-db-auto-update = true
http-api = Lucaschan@0.0.0.0:6171
http-api-tls = true
http-api-web-dashboard = true

[Proxy]
MY_Local_Proxy = wireguard, section-name=F16491DD, test-url=http://1.0.0.1/generate_204, ecn=true

[Proxy Group]
# 回国策略组：手动可切 DIRECT 作为应急
Return_China = select, MY_Local_Proxy, DIRECT, no-alert=0, hidden=0, include-all-proxies=0

# 自动切换：在家 Wi-Fi 直连，蜂窝走代理
Auto_Local = subnet, default=DIRECT, "BSSID:58:c6:7e:df:2d:51"=DIRECT, "TYPE:CELLULAR"=MY_Local_Proxy

# 国际流量：默认直连，必要时切代理
International = select, DIRECT, MY_Local_Proxy, no-alert=0, hidden=0, include-all-proxies=0
Fallback = fallback, MY_Local_Proxy, DIRECT, no-alert=0, hidden=0, include-all-proxies=0

[Rule]
# --- 基础过滤 ---
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/private.txt,DIRECT
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/reject.txt,REJECT
RULE-SET,SYSTEM,DIRECT
RULE-SET,LAN,DIRECT

# 抖音核心域名强制回国
OR,((DOMAIN-SUFFIX,amemv.com), (DOMAIN-SUFFIX,snssdk.com)),Return_China

# --- 苹果与云服务（建议直连） ---
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/icloud.txt,DIRECT
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/apple.txt,DIRECT

# --- 国际服务（默认直连） ---
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/google.txt,International
RULE-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/telegramcidr.txt,International,no-resolve

# --- 回国核心逻辑 ---
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/direct.txt,Auto_Local
RULE-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/cncidr.txt,Auto_Local,no-resolve
GEOIP,CN,Auto_Local,no-resolve

# --- 海外站点 ---
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/proxy.txt,International

# --- 兜底 ---
FINAL,Auto_Local,dns-failed

[Host]
# --- 1. 内网设备映射 ---
router.asus.com = 192.168.1.1
tplinkwifi.net = 192.168.0.1
router.lan = 192.168.1.1
localhost = 127.0.0.1
*.local = 127.0.0.1

# --- 2. 中国域名走国内 DNS ---
*.cn = server:223.5.5.5
*.alicdn.com = server:223.5.5.5
*.aliyun.com = server:223.5.5.5
*.taobao.com = server:223.5.5.5
*.tmall.com = server:223.5.5.5
*.qq.com = server:119.29.29.29
*.tencent.com = server:119.29.29.29
*.baidu.com = server:180.76.76.76

# --- 3. 国际服务走海外 DNS ---
*.google.com = server:8.8.8.8
*.youtube.com = server:8.8.8.8
*.facebook.com = server:8.8.8.8
*.instagram.com = server:8.8.8.8
*.netflix.com = server:8.8.8.8
*.telegram.org = server:8.8.8.8

# --- 4. Apple 服务保持本地 CDN ---
*.apple.com = server:system
*.icloud.com = server:system

[MITM]
skip-server-cert-verify = true
h2 = true

[WireGuard F16491DD]
private-key = kGHfJBcGlxExvXst8w8USmqxDsiUoxV7qMgkjIH/FUU=
self-ip = 172.16.0.2
self-ip-v6 = 2606:4700:cf1:1000::25
dns-server = 1.1.1.1
mtu = 1280
peer = (public-key = bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=, allowed-ips = "0.0.0.0/0, ::0/0", endpoint = 162.159.193.10:2408, keepalive = 25, client-id = 88/243/13)
