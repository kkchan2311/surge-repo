[General]
# --- 1. 基础连接优化 ---
# 确保网络接管最顺畅
compatibility-mode = 3
# 屏蔽 QUIC，让回国视频走 TCP，更稳定
block-quic = true
# 配合 Subnet Group，让切换逻辑更准确
exclude-suspended-proxies = true
# 其他配套建议
# 开启 Snell 的 TFO 必选
tcp-fast-open = true
# 开启 UDP 转发（如果 Snell 服务端支持）
udp-priority = false
# 允许跳过简单的域名，直接处理 IP
exclude-simple-hostnames = true
# 允许 Surge 独立处理所有的 DNS 请求
dns-server = 223.5.5.5, 114.114.114.114, 8.8.8.8, 1.1.1.1
# 加密 DNS：在马来西亚建议使用阿里或 Google 的 DoH，防止本地运营商 (如 TM/Maxis) 的 DNS 劫持
encrypted-dns-server = https://dns.alidns.com/dns-query, https://dns.google/dns-query
# 确保在进行 DNS 查询时，优先使用本地网络（马来西亚）的 DNS
hijack-dns = 8.8.8.8:53, 114.114.114.114:53
# --- 2. Snell 协议专属优化 ---
# 开启 TCP Fast Open (TFO)，可以减少 Snell 握手延迟
all-hybrid = true
# 开启所有界面的混合网络模式，在 Wi-Fi 和 5G 切换时连接不断开
internet-test-url = http://www.google.com/generate_204
# --- 3. 网络连通性测试 ---
# 测试网络是否在线的 URL
proxy-test-url = http://www.baidu.com/generate_204
# 测试代理节点延迟的 URL（回国场景建议使用百度或淘宝）
test-timeout = 3
proxy-test-udp = www.apple.com@64.6.64.6

ipv6 = false // 如无特殊需求不应开启 IPv6，目前网络环境下 IPv6 只会带来问题。
# --- 4. IPv6 处理 ---
# 如果马来西亚运营商支持 IPv6 且你不需要，建议关闭以减少路由冲突
ipv6-vif = disabled
skip-proxy = 127.0.0.1, 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, 100.64.0.0/10, localhost, *.local, *.crashlytics.com, *.edu.my, *.gov.my
# --- 5. 绕过本地流量 (Skip Proxy) ---
# 关键：确保马来西亚本地流量、内网流量不走代理
geoip-maxmind-url = https://raw.githubusercontent.com/Hackl0us/GeoIP2-CN/release/Country.mmdb
http-api = Lucaschan@0.0.0.0:6171
http-api-tls = true
http-api-web-dashboard = true

[Proxy]
MY_Local_Proxy = wireguard, section-name=F16491DD, test-url=http://1.0.0.1/generate_204, ecn=true

# 马来西亚本地/国际备用节点
# 中国回国加速节点
[Proxy Group]
# 1. 【回国策略组】用于解锁中国内容
Return_China = smart, MY_Local_Proxy, no-alert=0, hidden=0, include-all-proxies=0
# 2. 【自动切换组】基于你提供的 BSSID 自动判断
# 逻辑：在家 (BSSID 匹配) 强制直连，出门用蜂窝网络时可选本地代理加速
Auto_Local = subnet, default = DIRECT, "BSSID:58:c6:7e:df:2d:51" = DIRECT, "TYPE:CELLULAR" = MY_Local_Proxy

# 3. 【国际/谷歌策略组】
# 在马来西亚，Google/YouTube 建议直连或走本地代理
International = select, DIRECT, MY_Local_Proxy, no-alert=0, hidden=0, include-all-proxies=0
Fallback = fallback, MY_Local_Proxy, no-alert=0, hidden=0, include-all-proxies=0

[Rule]
# --- 基础过滤 ---
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/private.txt,DIRECT
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/reject.txt,REJECT
RULE-SET,SYSTEM,DIRECT
RULE-SET,LAN,DIRECT

OR,((DOMAIN-SUFFIX,amemv.com), (DOMAIN-SUFFIX,snssdk.com)),Return_China
# --- 苹果与云服务 (建议直连，保持马来西亚本地速度) ---
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/icloud.txt,DIRECT
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/apple.txt,DIRECT

# --- 国际服务 (谷歌/电报) ---
# 马来西亚直连 Google 很快，所以走 International (默认 DIRECT)
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/google.txt,International
RULE-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/telegramcidr.txt,International

# --- 【回国场景核心逻辑】 ---
# 这里是重点：原本“直连”的中国列表，现在全部送入 Return_China 策略组实现回国
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/direct.txt,Auto_Local
RULE-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/cncidr.txt,Auto_Local
GEOIP,CN,Auto_Local

# --- 原 GFW 列表 (proxy.txt) ---
# 在马来西亚，这些网站（如 FB/Twitter）是开放的，建议走 International (默认 DIRECT)
DOMAIN-SET,https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/proxy.txt,International

# --- 兜底规则 ---
# 匹配不到上述规则的流量，交给 Subnet 自动切换组判断
FINAL,Auto_Local,dns-failed

[Host]
# --- 1. 内网设备直接映射 ---
# 常见的路由器管理地址，根据你实际情况修改
router.asus.com = 192.168.1.1
tplinkwifi.net = 192.168.0.1
router.lan = 192.168.1.1
# 本地回环
localhost = 127.0.0.1
*.local = 127.0.0.1
# 你的 NAS 或其他马来西亚家中设备 (如有)
# mynas.home = 192.168.1.100

# --- 2. 中国大陆域名强制使用阿里 DNS (提高回国加载速度) ---
# 凡是 .cn 后缀，强制发往 223.5.5.5 解析
*.cn = server:223.5.5.5
# 阿里、腾讯、百度的核心域名，强制使用国内解析，避免在马来西亚解析出国际版 IP
*.alicdn.com = server:223.5.5.5
*.aliyun.com = server:223.5.5.5
*.taobao.com = server:223.5.5.5
*.tmall.com = server:223.5.5.5
*.qq.com = server:119.29.29.29
*.tencent.com = server:119.29.29.29
*.baidu.com = server:180.76.76.76

# --- 3. 国际服务强制使用 Google DNS (针对马来西亚环境) ---
# 在马来西亚，使用 Google DNS 解析国际域名通常比运营商 DNS 更干净、更快
*.google.com = server:8.8.8.8
*.youtube.com = server:8.8.8.8
*.facebook.com = server:8.8.8.8
*.instagram.com = server:8.8.8.8
*.netflix.com = server:8.8.8.8
*.telegram.org = server:8.8.8.8

# --- 4. Apple 服务直连优化 ---
# 强制 Apple 服务使用系统默认解析（走马来西亚本地 CDN）
*.apple.com = server:system
*.icloud.com = server:system

[MITM]
skip-server-cert-verify = true
h2 = true



[WireGuard F16491DD]
private-key = kGHfJBcGlxExvXst8w8USmqxDsiUoxV7qMgkjIH/FUU=
self-ip = 172.16.0.2
self-ip-v6 = 2606:4700:cf1:1000::25
dns-server = 1.1.1.1
mtu = 1280
peer = (public-key = bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=, allowed-ips = "0.0.0.0/0, ::0/0", endpoint = 162.159.193.10:2408, keepalive = 25, client-id = 88/243/13)
